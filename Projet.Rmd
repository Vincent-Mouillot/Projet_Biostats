---
title: "Projet"
author: "Vincent Mouillot  & Inès Rouached"
date: "20/12/2021"
output: 
  pdf_document: 
    toc: yes
    number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(tidyverse)
library(MASS)
library(ggplot2)
library(patchwork)
library(modelsummary)
```

\newpage

```{r, echo=FALSE}
Intoxications <- read_excel("Intoxications.xls") 
```

# Introduction

L’étude réalisée ici traite des individus ayant eu une intoxication alimentaire, en Inde en 1990, après une grande manifestation. Pour cela, les habitudes alimentaires sur une cohorte de ces individus ont été répertoriées. Suivant la problématique posée, différentes approches (méthodes) apprises en cours de biostatistique seront mises en avant.
L’objectif principal sera de construire de potentiels modèle qui permettent d’expliquer et de constater les liens statistiques qui peuvent exister.

Notre table comporte 1094 individus et 11 variables.
Parmis ces 11 variables, nous avons 9 variables qualitatives et 2 variables quantitatives.

Variables quantitatives :

id : identifiant
Age : l'âge en années


Variables qualitatives :

sex : Sexe, 0 : femme/ 1 : Homme
Boeuf : le sujet a-t-il mangé du boeuf au curry lors de l'événement ? 1 : Oui / 2 : Non
Oeuf : le sujet a-t-il mangé des oeufs frits lors de l'événement ? 1 : Oui / 2 : Non
Eau : le sujet a-t-il bu de l'eau distribuée ce jour là ? 1 : Oui / 2 : Non
Eclair : combien d'éclairs l'individu a mangé ce jour là. Les valeurs 80 et 90 correspondent respectivement à "a mangé des éclair sans se souvenir combien" et "donnée manquante".

Viennent ensuite les variables de symptôme : nausée, vomissement, douleur (abdominale) et diarrhée, constatés chez l'individu. Les symptômes constatés ont été codés de la façon suivante :
0 : pas de symtôme / 1 : symptôme / 99 : non renseigné.

```{r, echo=FALSE}
Intoxications <- Intoxications %>% 
  rename("Nausee"=`Nausée ?`,
         "Vomi" = `Vomissements ?`,
         "Diarrhee" = Diarrée,
         "Eclair" = eclair,
         "Sexe" = sex,
         "Age" = age) %>%
  filter(Age != 99,
         Boeuf != 9,
         Oeuf != 9,
         Eclair != 90,
         Eclair != 80,
         Eau != 9) %>% 
  mutate(Symptomes = Nausee + Vomi + Douleur + Diarrhee,
         Sexe = as.factor(Sexe),
         Nausee = as.factor(Nausee),
         Vomi = as.factor(Vomi),
         Douleur = as.factor(Douleur),
         Diarrhee = as.factor(Diarrhee), 
         Eclair = as.numeric(Eclair),
         Boeuf = as.factor(Boeuf),
         Oeuf = as.factor(Oeuf),
         Eau = as.factor(Eau),
         Malade = as.factor(if_else(Symptomes >= 1,
                             1,
                             0))) 
```

```{r, echo=FALSE}
Intoxications %>% head(5)
```

\newpage
#	Statistiques descriptives

Comme on a peu d'individus avec un ou des informations manquantes ($\frac{21}{1094} \approx 1.92\%$), on a décidé de les retirer du jeu de données.


```{r}
Intoxications %>% summary()
```



```{r, echo=FALSE}
g1 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Boeuf,
                 fill = Malade))

g2 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Oeuf,
                 fill = Malade))

g3 <- ggplot() +
  geom_histogram(data = Intoxications,
                 aes(Age,
                 fill = Malade),
                 binwidth = 5)

g4 <- ggplot() + 
  geom_histogram(data = Intoxications,
                 aes(Eclair,
                 fill = Malade),
                 binwidth = 1)

g5 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Sexe,
               fill = Malade))


(g5 | g1 | g2) / 
  g3 /
  g4 + 
  plot_layout(guides = 'collect')
```


```{r, echo=FALSE, fig.height=4}

g6 <- ggplot() + 
  geom_boxplot(data = Intoxications,
               aes(x = Malade,
                   y = Age,
                   fill = Malade))

g7 <- ggplot() + 
  geom_boxplot(data = Intoxications,
               aes(x = Malade,
                   y = Eclair,
                   fill = Malade))

(g6 |g7) + 
  plot_layout(guides = 'collect')
```


```{r, echo=FALSE, fig.height=2}
Intoxications <- Intoxications %>% 
  mutate(id = 1)

g8 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(id,
               fill = as.factor(Symptomes))) +
  guides(fill=guide_legend(title = "Symptomes"))

g8
```

\newpage
# Regression logistique





```{r,results='hide', warning=FALSE}
f <- stepAIC(object = glm(formula = Malade ~ Sexe * Eau * Boeuf * Oeuf * Age * Eclair,
    family = "binomial", 
    data = Intoxications),
    direction = "backward")
```

```{r}
f$converged
```


Méthode backaward pas adapté car trop de cas particulier et pas d'individus respectant ceux-ci.

```{r, results='hide'}
g <- glm(formula = Malade ~ 1,
    family = "binomial", 
    data = Intoxications)

fitforw <- stepAIC(object = g,
    direction = "forward",
    scope = list(lower = g,
                 upper = ~ Sexe * Age * Boeuf * Oeuf * Eau * Eclair))

```


```{r}
summary(fitforw)
```

```{r}
confint(fitforw)
```

\newpage
# Regression polytomique ordonnée

```{r, echo=FALSE}
g1 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Boeuf, fill = as.factor(Symptomes)),
           position = "dodge") +
  guides(fill=guide_legend(title="Symptomes"))

g2 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Oeuf, fill = as.factor(Symptomes)),
           position = "dodge") +
  guides(fill=guide_legend(title="Symptomes"))

g3 <- ggplot() +
  geom_histogram(data = Intoxications,
                 aes(Age, fill = as.factor(Symptomes)),
                 binwidth = 5) +
  guides(fill=guide_legend(title="Symptomes"))

g4 <- ggplot() + 
  geom_histogram(data = Intoxications,
                 aes(Eclair, fill = as.factor(Symptomes)),
                 binwidth = 1) +
  guides(fill=guide_legend(title="Symptomes"))

g5 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Sexe, fill = as.factor(Symptomes)),
           position = "dodge") +
  guides(fill=guide_legend(title="Symptomes"))

(g5 | g1 | g2 ) / 
  ((g4 / g3)) + 
  plot_layout(guides = 'collect')
```



```{r, echo=FALSE}
Intoxications <- Intoxications %>% 
  mutate(Symptomes = case_when(
    Symptomes == 0 ~ "Sain",
    Symptomes %in% c(1, 2) ~ "Peu malade",
    Symptomes %in% c(3, 4) ~ "Tres malade",
    TRUE ~ ""
  ))

Intoxications$Symptomes <- Intoxications$Symptomes %>% 
  as.factor() %>% 
  ordered(c("Sain", "Peu malade", "Tres malade"))

g1 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Boeuf, fill = Symptomes),
           position = "dodge") +
  guides(fill=guide_legend(title="Symptomes"))

g2 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Oeuf, fill = Symptomes),
           position = "dodge") +
  guides(fill=guide_legend(title="Symptomes"))

g3 <- ggplot() +
  geom_histogram(data = Intoxications,
                 aes(Age, fill = Symptomes),
                 binwidth = 5) +
  guides(fill=guide_legend(title="Symptomes"))

g4 <- ggplot() + 
  geom_histogram(data = Intoxications,
                 aes(Eclair, fill = Symptomes),
                 binwidth = 1) +
  guides(fill=guide_legend(title="Symptomes"))

g5 <- ggplot() +
  geom_bar(data = Intoxications,
           aes(Sexe, fill = Symptomes),
           position = "dodge") +
  guides(fill=guide_legend(title="Symptomes"))

(g5 | g1 | g2 ) / 
  ((g4 / g3)) + 
  plot_layout(guides = 'collect')
```


```{r, results='hide'}
g <- polr(Symptomes ~ 1, data = Intoxications)

fitforw <- stepAIC(object = g,
    direction = "forward",
    scope = list(lower = g,
                 upper = ~Sexe * Age * Boeuf * Oeuf * Eau * Eclair))
```


```{r}
summary(fitforw)
```




```{r}
confint(fitforw)
```





